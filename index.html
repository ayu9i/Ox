<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>XO SUPREME: ETERNAL CONQUEROR</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #020617; --cyan: #22d3ee; --pink: #f43f5e; --gold: #fbbf24;
            --diamond: #b9f2ff; --conqueror: #ff3e3e;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Kanit', sans-serif; background: var(--bg); color: white;
            margin: 0; padding: 10px; display: flex; justify-content: center;
            min-height: 100vh; overflow-y: auto;
            background: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #020617 100%);
        }
        .container {
            width: 100%; max-width: 480px; background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(25px); border-radius: 40px; padding: 20px;
            border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 0 60px rgba(0,0,0,0.7);
            text-align: center; margin-bottom: 30px;
        }

        /* Level & EXP Bar */
        .level-section { margin-bottom: 15px; text-align: left; }
        .level-info { display: flex; justify-content: space-between; font-family: 'Orbitron'; font-size: 0.8rem; margin-bottom: 5px; color: var(--cyan); }
        .exp-bar-bg { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        .exp-bar-fill { height: 100%; background: linear-gradient(90deg, var(--cyan), #818cf8); width: 0%; transition: 0.5s; }

        .coin-box { font-size: 2.2rem; color: var(--gold); font-weight: bold; font-family: 'Orbitron'; margin: 10px 0; }

        /* Chat System */
        .chat-box { background: rgba(0,0,0,0.4); border-radius: 20px; height: 120px; overflow-y: auto; padding: 10px; margin: 15px 0; font-size: 0.75rem; text-align: left; border: 1px solid rgba(255,255,255,0.05); }
        .chat-msg { margin-bottom: 5px; animation: slideIn 0.3s ease; }
        .chat-user { color: var(--cyan); font-weight: bold; }
        .chat-system { color: var(--gold); font-style: italic; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }

        /* General UI */
        .board { display: grid; gap: 8px; background: rgba(0,0,0,0.3); padding: 12px; border-radius: 25px; border: 1px solid rgba(255,255,255,0.1); margin: 15px 0; }
        .board-3 { grid-template-columns: repeat(3, 1fr); }
        .board-5 { grid-template-columns: repeat(5, 1fr); }
        .cell { aspect-ratio: 1/1; background: rgba(30, 41, 59, 0.6); border-radius: 15px; font-size: 2rem; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); }
        
        .btn { font-family: 'Orbitron'; background: linear-gradient(90deg, #0ea5e9, #6366f1); color: white; border: none; padding: 12px; border-radius: 15px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 8px; font-size: 0.8rem; }
        .skin-tray { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .skin-item { min-width: 60px; height: 60px; background: rgba(0,0,0,0.4); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; border: 2px solid transparent; flex-shrink: 0; }
        .skin-item.active { border-color: var(--cyan); box-shadow: 0 0 10px var(--cyan); }

        input { background: rgba(0,0,0,0.5); border: 1px solid #334155; color: white; padding: 10px; border-radius: 12px; width: 100%; margin-bottom: 8px; font-family: 'Kanit'; }
    </style>
</head>
<body>

<div class="container">
    <div id="scr-start">
        <h1 style="font-family:'Orbitron'; color:var(--cyan); letter-spacing:3px;">XO SUPREME</h1>
        <p style="font-size:0.8rem; opacity:0.6;">ETERNAL CONQUEROR</p>
        <div style="margin-top: 30px;">
            <input type="text" id="inName" placeholder="ENTER PLAYER NAME">
            <button class="btn" style="font-size:1rem;" onclick="login()">LOGIN TO SERVER</button>
        </div>
    </div>

    <div id="scr-game" style="display:none">
        <div class="level-section">
            <div class="level-info">
                <span id="lvl-txt">LEVEL 1 (Novice)</span>
                <span id="exp-txt">0/100 EXP</span>
            </div>
            <div class="exp-bar-bg"><div id="exp-fill" class="exp-bar-fill"></div></div>
        </div>

        <div class="coin-box">ðŸª™ <span id="coin-txt">0</span></div>

        <div class="chat-box" id="chat-content">
            <div class="chat-msg"><span class="chat-system">[System]:</span> Welcome to the Global Server!</div>
        </div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="chat-input" placeholder="à¸žà¸´à¸¡à¸žà¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸Šà¸—..." style="margin-bottom:0; font-size:0.8rem;">
            <button class="btn" style="width:70px; margin-top:0;" onclick="sendChat()">à¸ªà¹ˆà¸‡</button>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top:10px;">
            <button class="btn" style="background:linear-gradient(90deg, #f59e0b, #ea580c);" onclick="spin()">LUCKY SPIN</button>
            <button class="btn" style="background:#8b5cf6;" onclick="buyLoot()">LOOT BOX</button>
        </div>

        <div class="skin-tray" id="tray"></div>

        <select id="size-mode" onchange="resetBoard()" style="background:#0f172a; color:white; border:1px solid #334155; padding:8px; border-radius:10px; width:100%;">
            <option value="3">CLASSIC 3X3</option>
            <option value="5">ELITE 5X5</option>
        </select>

        <div id="grid" class="board"></div>

        <button class="btn" style="background:transparent; border:1px solid #334155;" onclick="resetBoard()">REMATCH</button>

        <div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:20px; margin-top:15px;">
            <div style="font-size:0.7rem; color:var(--cyan); margin-bottom:5px;">REDEEM CODE</div>
            <input type="text" id="codeIn" placeholder="Enter Secret Code" style="font-size:0.8rem; text-align:center;">
            <button class="btn" style="background:#10b981; margin-top:0;" onclick="redeem()">REDEEM</button>
        </div>
    </div>
</div>

<script>
    let coins = parseInt(localStorage.getItem('xo_v4_coins')) || 0;
    let exp = parseInt(localStorage.getItem('xo_v4_exp')) || 0;
    let lvl = parseInt(localStorage.getItem('xo_v4_lvl')) || 1;
    let user = localStorage.getItem('xo_v4_user') || '';
    let board = [];
    let isPlaying = true;
    let skin = 'Default';
    const skinsData = [
        {id:'Default', s:['X','O']}, {id:'Neon', s:['ðŸ’ ','ðŸ’Ž']}, 
        {id:'Fire', s:['ðŸ”¥','â„ï¸']}, {id:'God', s:['ðŸ‘‘','ðŸ’€']}
    ];
    let owned = JSON.parse(localStorage.getItem('xo_v4_owned')) || ['Default'];

    // Login
    function login() {
        let n = document.getElementById('inName').value || user;
        if(n) {
            user = n; localStorage.setItem('xo_v4_user', user);
            document.getElementById('scr-start').style.display='none';
            document.getElementById('scr-game').style.display='block';
            resetBoard();
            setInterval(randomChat, 5000); // Start random chat
        }
    }

    // EXP & Level System
    function addExp(amt) {
        exp += amt;
        let nextLvl = lvl * 200;
        if(exp >= nextLvl) {
            exp -= nextLvl;
            lvl++;
            coins += 500;
            addChatMessage("System", `Congratulations! Level Up to ${lvl}! (+500 ðŸª™)`, true);
            confetti({ particleCount: 100 });
        }
        updateUI();
    }

    function resetBoard() {
        let s = parseInt(document.getElementById('size-mode').value);
        board = Array(s*s).fill('');
        isPlaying = true;
        document.getElementById('grid').className = `board board-${s}`;
        updateUI();
    }

    function updateUI() {
        const g = document.getElementById('grid'); g.innerHTML = '';
        board.forEach((v, i) => {
            const c = document.createElement('div');
            c.className = 'cell'; c.innerText = v;
            const icons = skinsData.find(x=>x.id===skin).s;
            if(v) c.style.color = (v === icons[0]) ? 'var(--cyan)' : 'var(--pink)';
            c.onclick = () => tap(i);
            g.appendChild(c);
        });
        
        document.getElementById('coin-txt').innerText = coins.toLocaleString();
        document.getElementById('lvl-txt').innerText = `LEVEL ${lvl} (${getRankName(lvl)})`;
        document.getElementById('exp-txt').innerText = `${exp}/${lvl*200} EXP`;
        document.getElementById('exp-fill').style.width = `${(exp/(lvl*200))*100}%`;

        const tray = document.getElementById('tray'); tray.innerHTML = '';
        skinsData.filter(s=>owned.includes(s.id)).forEach(sk => {
            const d = document.createElement('div');
            d.className = `skin-item ${skin===sk.id?'active':''}`;
            d.innerHTML = sk.s[0];
            d.onclick = () => { skin = sk.id; updateUI(); };
            tray.appendChild(d);
        });
        save();
    }

    function getRankName(l) {
        if(l >= 20) return "Grandmaster";
        if(l >= 10) return "Legend";
        if(l >= 5) return "Veteran";
        return "Novice";
    }

    // Gameplay
    function tap(i) {
        if(board[i]==='' && isPlaying) {
            let icons = skinsData.find(x=>x.id===skin).s;
            board[i] = icons[0];
            if(check(icons[0])) win();
            else if(board.every(x=>x!=='')) resetBoard();
            else { isPlaying = false; setTimeout(bot, 400); }
            updateUI();
        }
    }

    function bot() {
        let icons = skinsData.find(x=>x.id===skin).s;
        let e = board.map((v,i)=>v===''?i:null).filter(v=>v!==null);
        if(e.length > 0) {
            board[e[Math.floor(Math.random()*e.length)]] = icons[1];
            if(check(icons[1])) { alert("Defeat!"); resetBoard(); }
        }
        isPlaying = true; updateUI();
    }

    function check(p) {
        let sz = parseInt(document.getElementById('size-mode').value);
        let win = sz === 3 ? 3 : 4;
        for(let i=0; i<sz*sz; i++) {
            if(board[i]===p) {
                if(i%sz<=sz-win) {
                    let w=true; for(let j=0; j<win; j++) if(board[i+j]!==p) w=false;
                    if(w) return true;
                }
                if(i<sz*(sz-win+1)) {
                    let w=true; for(let j=0; j<win; j++) if(board[i+j*sz]!==p) w=false;
                    if(w) return true;
                }
            }
        }
        return false;
    }

    function win() {
        coins += 100; addExp(50);
        confetti({ particleCount: 150, spread: 70 });
        alert("Victory! +100 Coins +50 EXP");
        resetBoard();
    }

    // Chat System
    function addChatMessage(sender, msg, isSystem = false) {
        const content = document.getElementById('chat-content');
        const div = document.createElement('div');
        div.className = 'chat-msg';
        div.innerHTML = isSystem ? `<span class="chat-system">[${sender}]: ${msg}</span>` : `<span class="chat-user">${sender}:</span> ${msg}`;
        content.appendChild(div);
        content.scrollTop = content.scrollHeight;
    }

    function sendChat() {
        const inp = document.getElementById('chat-input');
        if(inp.value) {
            addChatMessage(user, inp.value);
            inp.value = '';
        }
    }

    function randomChat() {
        const users = ["Zoro_TH", "SkinHunter", "GG_Ez", "ProPlayer99"];
        const msgs = ["à¸¡à¸µà¸„à¸™à¹à¸ˆà¸à¹‚à¸„à¹‰à¸”à¸¡à¸±à¹‰à¸¢à¸„à¸£à¸±à¸š?", "à¸ªà¸¸à¹ˆà¸¡à¸ªà¸à¸´à¸™à¸¢à¸²à¸à¸ˆà¸±à¸‡", "à¸žà¸¶à¹ˆà¸‡à¹€à¸¥à¹€à¸§à¸¥à¸­à¸±à¸›à¹€à¸¥à¸¢!", "à¸šà¸­à¸—à¹‚à¸«à¸”à¸ˆà¸±à¸‡ 5x5"];
        addChatMessage(users[Math.floor(Math.random()*users.length)], msgs[Math.floor(Math.random()*msgs.length)]);
    }

    // Other Systems
    function spin() { coins += 50; addExp(10); alert("Got 50 Coins!"); updateUI(); }
    function buyLoot() {
        if(coins >= 300) {
            coins -= 300; addExp(30);
            let locked = skinsData.filter(s=>!owned.includes(s.id));
            if(locked.length > 0) {
                let s = locked[0]; owned.push(s.id);
                addChatMessage("System", `${user} unlocked skin: ${s.id}!`, true);
            }
            updateUI();
        }
    }

    function redeem() {
        let c = document.getElementById('codeIn').value.toUpperCase();
        if(c === 'WELCOME2025') { coins += 1000; alert("Success!"); }
        else if(c === 'GODMODE') { if(!owned.includes('God')) owned.push('God'); alert("Skin God Unlocked!"); }
        else { alert("Invalid Code"); }
        document.getElementById('codeIn').value = '';
        updateUI();
    }

    function save() {
        localStorage.setItem('xo_v4_coins', coins);
        localStorage.setItem('xo_v4_exp', exp);
        localStorage.setItem('xo_v4_lvl', lvl);
        localStorage.setItem('xo_v4_owned', JSON.stringify(owned));
    }

    if(user) login();
</script>
</body>
</html>
