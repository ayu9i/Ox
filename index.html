<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>XO SUPREME: OMNI-GOD EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #020617; --cyan: #22d3ee; --pink: #f43f5e; --gold: #fbbf24;
            --green: #10b981; --red: #ef4444; --glass: rgba(15, 23, 42, 0.9);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Kanit', sans-serif; }
        body {
            background: var(--bg); color: white; margin: 0; padding: 10px;
            display: flex; justify-content: center; min-height: 100vh;
            background: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #020617 100%);
        }
        .container {
            width: 100%; max-width: 480px; background: var(--glass);
            backdrop-filter: blur(20px); border-radius: 30px; padding: 20px;
            border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 0 50px rgba(0,0,0,0.8);
            position: relative; overflow: hidden;
        }

        /* --- UI Elements --- */
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-family: 'Orbitron'; font-size: 0.7rem; }
        .ping-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--green); display: inline-block; box-shadow: 0 0 5px var(--green); }
        
        .stats-panel { background: rgba(0,0,0,0.3); padding: 12px; border-radius: 20px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.05); }
        .level-row { display: flex; justify-content: space-between; font-family: 'Orbitron'; font-size: 0.8rem; color: var(--cyan); margin-bottom: 5px; }
        .exp-track { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        .exp-fill { height: 100%; background: linear-gradient(90deg, var(--cyan), #818cf8); width: 0%; transition: 0.5s; }
        
        .coin-box { font-size: 2.2rem; color: var(--gold); font-weight: bold; font-family: 'Orbitron'; text-align: center; margin: 10px 0; text-shadow: 0 0 10px rgba(251,191,36,0.3); }

        /* --- Leaderboard --- */
        .leaderboard { background: rgba(251, 191, 36, 0.05); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 15px; padding: 10px; margin-bottom: 15px; }
        .lb-title { font-family: 'Orbitron'; color: var(--gold); font-size: 0.8rem; text-align: center; margin-bottom: 8px; border-bottom: 1px solid rgba(251,191,36,0.2); padding-bottom: 5px; }
        .lb-item { display: flex; justify-content: space-between; font-size: 0.75rem; padding: 3px 5px; background: rgba(0,0,0,0.2); margin-bottom: 3px; border-radius: 5px; }
        .lb-rank { color: var(--cyan); font-weight: bold; width: 20px; }
        .lb-wins { color: var(--gold); font-family: 'Orbitron'; font-size: 0.7rem; }

        /* --- Chat --- */
        .chat-box { background: rgba(0,0,0,0.4); border-radius: 12px; height: 100px; overflow-y: auto; padding: 10px; font-size: 0.75rem; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 5px; }
        .chat-msg { margin-bottom: 3px; line-height: 1.2; }
        .chat-sys { color: var(--gold); font-style: italic; }

        /* --- Game Board --- */
        .board { display: grid; gap: 8px; background: rgba(0,0,0,0.3); padding: 12px; border-radius: 20px; margin: 10px 0; border: 1px solid rgba(255,255,255,0.05); }
        .board-3 { grid-template-columns: repeat(3, 1fr); }
        .board-5 { grid-template-columns: repeat(5, 1fr); }
        .cell { aspect-ratio: 1/1; background: rgba(30, 41, 59, 0.7); border-radius: 12px; font-size: 2rem; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; border: 1px solid rgba(255,255,255,0.03); }
        .cell:active { transform: scale(0.9); background: rgba(255,255,255,0.1); }

        /* --- Buttons & Inputs --- */
        .btn { font-family: 'Orbitron'; background: linear-gradient(90deg, #0ea5e9, #6366f1); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 5px; font-size: 0.8rem; }
        .btn-red { background: linear-gradient(90deg, #f43f5e, #be123c); }
        input, select { background: rgba(0,0,0,0.5); border: 1px solid #334155; color: white; padding: 12px; border-radius: 12px; width: 100%; margin-bottom: 8px; font-size: 0.9rem; }

        /* --- Overlay --- */
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div id="overlay">
        <h1 style="font-family:'Orbitron'; color:var(--cyan); margin-bottom: 5px;">XO SUPREME</h1>
        <p id="ov-desc" style="font-size:0.8rem; opacity:0.6; margin-bottom: 30px;">GLOBAL SERVER v5.0</p>
        
        <div id="login-form" style="width:100%">
            <input type="text" id="inName" placeholder="ENTER AGENT NAME">
            <button class="btn" onclick="login()">CONNECT</button>
        </div>

        <div id="matching-ui" style="display:none">
            <div style="width:50px; height:50px; border:4px solid rgba(255,255,255,0.1); border-top:4px solid var(--cyan); border-radius:50%; animation:spin 1s linear infinite; margin-bottom:20px;"></div>
            <p id="t-search" style="font-family:'Orbitron';">SEARCHING FOR OPPONENT...</p>
        </div>
    </div>

    <div id="game-ui" style="display:none">
        <div class="top-bar">
            <div><div id="ping-dot" class="ping-dot"></div> <span id="ping-val">24</span>ms</div>
            <button onclick="toggleLang()" style="background:none; border:1px solid var(--cyan); color:var(--cyan); padding:2px 10px; border-radius:5px; cursor:pointer;" id="lang-btn">EN</button>
        </div>

        <div class="stats-panel">
            <div class="level-row"><span id="lvl-txt">LVL 1</span><span id="exp-txt">0/200</span></div>
            <div class="exp-track"><div id="exp-fill" class="exp-fill"></div></div>
        </div>

        <div class="coin-box">ü™ô <span id="coin-txt">0</span></div>

        <div class="leaderboard">
            <div class="lb-title" id="t-lb-title">GOD TIER RANKING (HARD ONLY)</div>
            <div id="lb-content"></div>
        </div>

        <div class="chat-box" id="chat-content"></div>
        <div style="display:flex; gap:5px; margin-bottom:10px;">
            <input type="text" id="chat-input" placeholder="..." style="margin:0; padding:8px;">
            <button class="btn" style="width:50px; margin:0; padding:0;" onclick="sendChat()">‚û§</button>
        </div>

        <select id="diff-mode" onchange="warnDifficulty()">
            <option value="easy">DIFFICULTY: EASY (0 ü™ô)</option>
            <option value="normal">DIFFICULTY: NORMAL (0 ü™ô)</option>
            <option value="hard" selected>DIFFICULTY: IMPOSSIBLE (GOD üèÜ)</option>
        </select>
        
        <select id="size-mode" onchange="resetBoard()">
            <option value="3">MODE: CLASSIC 3X3</option>
            <option value="5">MODE: ELITE 5X5</option>
        </select>

        <div id="grid" class="board"></div>

        <button class="btn btn-red" onclick="startMatch()" id="t-play">FIND NEW MATCH</button>
    </div>
</div>

<script>
    /* --- Game Data --- */
    let lang = 'TH';
    let user = localStorage.getItem('xo_v6_user') || '';
    let coins = parseInt(localStorage.getItem('xo_v6_coins')) || 0;
    let exp = parseInt(localStorage.getItem('xo_v6_exp')) || 0;
    let lvl = parseInt(localStorage.getItem('xo_v6_lvl')) || 1;
    let godWins = parseInt(localStorage.getItem('xo_v6_godwins')) || 0;
    
    let board = [];
    let isPlaying = false;
    let currentPing = 20;

    const i18n = {
        TH: { search: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á...", play: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡πâ‡∏≠‡∏á", win: "‡∏ä‡∏ô‡∏∞!", lose: "‡πÅ‡∏û‡πâ!", draw: "‡πÄ‡∏™‡∏°‡∏≠", lb: "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡πÇ‡∏´‡∏°‡∏î‡πÇ‡∏´‡∏î)", sys: "‡∏£‡∏∞‡∏ö‡∏ö" },
        EN: { search: "SEARCHING FOR OPPONENT...", play: "FIND NEW MATCH", win: "VICTORY!", lose: "DEFEAT!", draw: "DRAW", lb: "GOD TIER RANKING (HARD)", sys: "SYSTEM" }
    };

    /* --- Core Functions --- */
    function login() {
        let name = document.getElementById('inName').value || user;
        if (name) {
            user = name;
            localStorage.setItem('xo_v6_user', user);
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';
            updateUI();
            resetBoard();
            addChatSys("Connected to Global Server as " + user);
        }
    }

    function toggleLang() {
        lang = lang === 'TH' ? 'EN' : 'TH';
        document.getElementById('lang-btn').innerText = lang === 'TH' ? 'EN' : 'TH';
        updateUI();
    }

    function startMatch() {
        document.getElementById('overlay').style.display = 'flex';
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('matching-ui').style.display = 'block';
        document.getElementById('t-search').innerText = i18n[lang].search;

        setTimeout(() => {
            document.getElementById('overlay').style.display = 'none';
            isPlaying = true;
            resetBoard();
            addChatSys("Match Found! Opponent: " + ["BOT_ALPHA", "X-Slayer", "Z_Pro"][Math.floor(Math.random()*3)]);
        }, 2000);
    }

    function resetBoard() {
        let size = parseInt(document.getElementById('size-mode').value);
        board = Array(size * size).fill('');
        const g = document.getElementById('grid');
        g.className = `board board-${size}`;
        renderBoard();
    }

    function renderBoard() {
        const g = document.getElementById('grid'); g.innerHTML = '';
        board.forEach((val, i) => {
            const c = document.createElement('div');
            c.className = 'cell';
            c.innerText = val;
            if (val === 'X') c.style.color = 'var(--cyan)';
            if (val === 'O') c.style.color = 'var(--pink)';
            c.onclick = () => tap(i);
            g.appendChild(c);
        });
    }

    function tap(i) {
        if (!isPlaying) { alert("Please Find Match first!"); return; }
        if (board[i] === '') {
            board[i] = 'X';
            renderBoard();
            if (checkWin('X')) endGame('win');
            else if (board.every(cell => cell !== '')) endGame('draw');
            else {
                isPlaying = false;
                setTimeout(botMove, 500);
            }
        }
    }

    /* --- AI Bot Intelligence --- */
    function botMove() {
        let diff = document.getElementById('diff-mode').value;
        let empty = board.map((v,i) => v === '' ? i : null).filter(v => v !== null);
        if (empty.length === 0) return;

        let move;
        if (diff === 'hard') {
            move = findBestMove('O', 'X', empty); // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ß‡∏≤‡∏á‡∏Ñ‡∏ô‡πÄ‡∏•‡πà‡∏ô
        } else if (diff === 'normal' && Math.random() > 0.4) {
            move = findBestMove('O', 'X', empty);
        } else {
            move = empty[Math.floor(Math.random() * empty.length)]; // ‡∏™‡∏∏‡πà‡∏° (Easy)
        }

        board[move] = 'O';
        renderBoard();
        if (checkWin('O')) endGame('lose');
        else if (board.every(cell => cell !== '')) endGame('draw');
        else isPlaying = true;
    }

    function findBestMove(me, opp, empty) {
        // 1. ‡∏´‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¢
        for (let i of empty) {
            board[i] = me;
            if (checkWin(me)) { board[i] = ''; return i; }
            board[i] = '';
        }
        // 2. ‡∏Ç‡∏ß‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏ä‡∏ô‡∏∞
        for (let i of empty) {
            board[i] = opp;
            if (checkWin(opp)) { board[i] = ''; return i; }
            board[i] = '';
        }
        // 3. ‡∏¢‡∏∂‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á
        let mid = Math.floor(board.length/2);
        if (board[mid] === '') return mid;

        return empty[Math.floor(Math.random() * empty.length)];
    }

    /* --- Winning Logic --- */
    function checkWin(p) {
        let sz = parseInt(document.getElementById('size-mode').value);
        let winNeeded = sz === 3 ? 3 : 4;
        
        for (let i = 0; i < sz * sz; i++) {
            if (board[i] === p) {
                if (checkLine(i, 1, winNeeded, p, sz) || // ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô
                    checkLine(i, sz, winNeeded, p, sz) || // ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á
                    checkLine(i, sz+1, winNeeded, p, sz) || // ‡∏ó‡∏∞‡πÅ‡∏¢‡∏á‡∏Ç‡∏ß‡∏≤
                    checkLine(i, sz-1, winNeeded, p, sz)) { // ‡∏ó‡∏∞‡πÅ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢
                    return true;
                }
            }
        }
        return false;
    }

    function checkLine(idx, step, target, p, sz) {
        let count = 0;
        for (let k = 0; k < target; k++) {
            let n = idx + k * step;
            if (n < 0 || n >= sz * sz || board[n] !== p) return false;
            if (step === 1 && Math.floor(n/sz) !== Math.floor(idx/sz)) return false; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
        }
        return true;
    }

    /* --- Rewards & Progress --- */
    function endGame(res) {
        isPlaying = false;
        let diff = document.getElementById('diff-mode').value;
        
        if (res === 'win') {
            let gainCoin = 0;
            let gainExp = 0;

            if (diff === 'hard') {
                gainCoin = 200; gainExp = 100; godWins++;
                confetti({ particleCount: 150, spread: 70 });
            } else if (diff === 'normal') {
                gainExp = 40;
            } else {
                gainExp = 10;
            }

            coins += gainCoin;
            addExp(gainExp);
            alert(i18n[lang].win + "\n+" + gainCoin + " ü™ô | +" + gainExp + " EXP");
        } else {
            addExp(10);
            alert(res === 'lose' ? i18n[lang].lose : i18n[lang].draw);
        }
        updateUI();
    }

    function addExp(amt) {
        exp += amt;
        if (exp >= lvl * 200) {
            exp -= lvl * 200;
            lvl++;
            coins += 500;
            addChatSys("LEVEL UP! LVL " + lvl + " (+500 ü™ô)");
        }
        save();
    }

    function updateUI() {
        document.getElementById('coin-txt').innerText = coins.toLocaleString();
        document.getElementById('lvl-txt').innerText = "LVL " + lvl;
        document.getElementById('exp-txt').innerText = exp + "/" + (lvl*200);
        document.getElementById('exp-fill').style.width = (exp / (lvl*200) * 100) + "%";
        document.getElementById('t-play').innerText = i18n[lang].play;
        document.getElementById('t-lb-title').innerText = i18n[lang].lb;

        // Leaderboard Update
        let lbData = [
            {n: user, w: godWins}, {n: "BOT_ALEX", w: 85}, {n: "Somsak_TH", w: 42}, {n: "NoobMaster", w: 5}
        ].sort((a,b) => b.w - a.w);

        let lbHtml = '';
        lbData.forEach((p, i) => {
            lbHtml += `<div class="lb-item"><span class="lb-rank">${i+1}</span><span>${p.n}</span><span class="lb-wins">${p.w} WINS</span></div>`;
        });
        document.getElementById('lb-content').innerHTML = lbHtml;
    }

    /* --- Helpers --- */
    function sendChat() {
        let i = document.getElementById('chat-input');
        if (i.value) {
            let box = document.getElementById('chat-content');
            box.innerHTML += `<div class="chat-msg"><b>${user}:</b> ${i.value}</div>`;
            i.value = ''; box.scrollTop = box.scrollHeight;
        }
    }
    function addChatSys(m) {
        let box = document.getElementById('chat-content');
        box.innerHTML += `<div class="chat-msg chat-sys">[${i18n[lang].sys}] ${m}</div>`;
        box.scrollTop = box.scrollHeight;
    }
    function warnDifficulty() {
        let d = document.getElementById('diff-mode').value;
        if (d !== 'hard') addChatSys("Warning: Easy/Normal mode won't give Coins!");
    }
    function save() {
        localStorage.setItem('xo_v6_coins', coins);
        localStorage.setItem('xo_v6_exp', exp);
        localStorage.setItem('xo_v6_lvl', lvl);
        localStorage.setItem('xo_v6_godwins', godWins);
    }

    setInterval(() => {
        currentPing = Math.floor(Math.random() * 40) + 15;
        document.getElementById('ping-val').innerText = currentPing;
        document.getElementById('ping-dot').style.background = currentPing > 100 ? 'var(--red)' : 'var(--green)';
    }, 2000);

    @keyframes spin { 100% { transform: rotate(360deg); } }
    
    // Auto-login if data exists
    if (user) {
        document.getElementById('inName').value = user;
    }
</script>
</body>
</html>
