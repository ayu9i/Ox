<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XO Ultimate - Battle & AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0f172a; --panel: #1e293b; --accent: #38bdf8; --text: #f8fafc; --gold: #fbbf24; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg); color: var(--text); text-align: center; margin: 0; padding: 10px; }
        .header { background: var(--panel); padding: 15px; border-radius: 20px; display: inline-block; margin-bottom: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); width: 95%; max-width: 400px; border: 1px solid #334155; }
        .coin-display { font-size: 2rem; color: var(--gold); font-weight: bold; }
        .board { display: grid; grid-template-columns: repeat(3, 95px); gap: 10px; justify-content: center; margin: 15px auto; }
        .cell { width: 95px; height: 95px; background: var(--panel); border: 2px solid #334155; font-size: 2.5rem; cursor: pointer; color: white; border-radius: 15px; transition: 0.2s; }
        .cell:hover { border-color: var(--accent); transform: translateY(-3px); }
        .mode-btn { background: #475569; color: white; padding: 8px 15px; border-radius: 8px; border: none; cursor: pointer; margin: 5px; font-size: 0.9rem; }
        .mode-btn.active { background: var(--accent); color: #000; font-weight: bold; }
        button.main-btn { background: linear-gradient(45deg, #38bdf8, #818cf8); color: white; width: 100%; max-width: 280px; font-weight: bold; padding: 15px; border-radius: 12px; border: none; cursor: pointer; margin-top: 10px; font-size: 1.1rem; }
        .history { margin-top: 20px; background: var(--panel); padding: 15px; border-radius: 15px; max-width: 400px; margin: 20px auto; text-align: left; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="setup-section">
        <h1>üéÆ XO ULTIMATE</h1>
        <input type="text" id="usernameInput" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" style="padding:12px; border-radius:8px; border:none; width: 200px;"><br>
        <button onclick="saveName()" class="main-btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏™‡∏ô‡∏≤‡∏°‡∏£‡∏ö</button>
    </div>

    <div id="game-section" style="display:none;">
        <div class="header">
            <div id="rank-display" style="font-size: 0.8rem; color: var(--accent);">RANK: BRONZE</div>
            <div class="coin-display">ü™ô <span id="coin-count">0</span></div>
            <div style="margin: 10px 0;">
                <button id="btn-ai" class="mode-btn active" onclick="setMode('ai')">‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ö AI</button>
                <button id="btn-pvp" class="mode-btn" onclick="setMode('pvp')">‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</button>
            </div>
            <div id="ai-settings">
                ‡∏£‡∏∞‡∏î‡∏±‡∏ö AI: 
                <select id="difficulty" style="background:#0f172a; color:white; border-radius:5px; padding:5px;">
                    <option value="easy">‡∏á‡πà‡∏≤‡∏¢ (+10)</option>
                    <option value="medium">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (+30)</option>
                    <option value="hard">‡∏¢‡∏≤‡∏Å‡∏ô‡∏£‡∏Å! (‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ä‡∏ô‡∏∞ 5%)</option>
                </select>
            </div>
            <div style="font-size: 0.8rem; margin-top: 10px;">
                ‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô/‡∏¢‡∏∂‡∏î‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç: <input type="number" id="betAmount" style="width:60px; background:#0f172a; color:white; border:none; text-align:center;" value="0"> ü™ô
            </div>
        </div>

        <div class="board" id="board"></div>
        <button onclick="resetGame()" class="main-btn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà / ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô</button>

        <div class="history">
            <h4 style="margin: 0 0 10px 0; color: var(--accent);">üìú ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ</h4>
            <div id="battle-log"></div>
        </div>

        <div style="margin-top:20px; opacity: 0.6; font-size: 0.7rem;">
            ‡πÇ‡∏Ñ‡πâ‡∏î‡∏£‡∏±‡∏ö 2000 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç: <input type="text" id="promoInput" style="width:80px;">
            <button onclick="redeemCode()">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <script>
        let coins = parseInt(localStorage.getItem('xo_coins')) || 0;
        let userName = localStorage.getItem('xo_username') || '';
        let history = JSON.parse(localStorage.getItem('xo_history')) || [];
        let board = Array(9).fill('');
        let gameActive = true;
        let gameMode = 'ai';
        let currentPlayer = 'X';

        function saveName() {
            const name = document.getElementById('usernameInput').value;
            if(name) { userName = name; localStorage.setItem('xo_username', name); showGame(); }
        }

        function showGame() {
            document.getElementById('setup-section').style.display='none';
            document.getElementById('game-section').style.display='block';
            updateUI();
        }

        function setMode(mode) {
            gameMode = mode;
            document.getElementById('btn-ai').className = mode === 'ai' ? 'mode-btn active' : 'mode-btn';
            document.getElementById('btn-pvp').className = mode === 'pvp' ? 'mode-btn active' : 'mode-btn';
            document.getElementById('ai-settings').style.display = mode === 'ai' ? 'block' : 'none';
            resetGame();
        }

        function updateUI() {
            const boardDiv = document.getElementById('board');
            boardDiv.innerHTML = '';
            board.forEach((cell, i) => {
                const btn = document.createElement('button');
                btn.className = 'cell'; btn.innerText = cell;
                btn.onclick = () => playTurn(i);
                boardDiv.appendChild(btn);
            });
            document.getElementById('coin-count').innerText = coins.toLocaleString();
            renderHistory();
        }

        function playTurn(i) {
            if(board[i] === '' && gameActive) {
                board[i] = currentPlayer;
                updateUI();
                if(checkWin(board, currentPlayer)) {
                    handleGameOver(currentPlayer);
                } else if(board.every(s=>s!=='')) {
                    handleGameOver('tie');
                } else {
                    if(gameMode === 'ai') {
                        gameActive = false;
                        setTimeout(aiMove, 500);
                    } else {
                        currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                    }
                }
            }
        }

        function aiMove() {
            const diff = document.getElementById('difficulty').value;
            let m;
            if (diff === 'hard') {
                m = (Math.random() < 0.05) ? randomMove() : minimax(board, 'O').index;
            } else if (diff === 'medium') {
                m = (Math.random() < 0.4) ? minimax(board, 'O').index : randomMove();
            } else { m = randomMove(); }

            board[m] = 'O'; gameActive = true;
            if(checkWin(board, 'O')) handleGameOver('O');
            else if(board.every(s=>s!=='')) handleGameOver('tie');
            updateUI();
        }

        function handleGameOver(w) {
            gameActive = false;
            const bet = parseInt(document.getElementById('betAmount').value) || 0;
            const diff = document.getElementById('difficulty').value;
            let resultMsg = "";

            if(gameMode === 'ai') {
                if(w === 'X') {
                    const prize = {easy:10, medium:30, hard:50}[diff] + bet;
                    coins += prize; resultMsg = `‡∏ä‡∏ô‡∏∞ AI! ‡∏£‡∏±‡∏ö ${prize} ü™ô`;
                } else if(w === 'O') {
                    coins -= bet; if(coins < 0) coins = 0;
                    resultMsg = `‡πÅ‡∏û‡πâ AI! ‡πÄ‡∏™‡∏µ‡∏¢ ${bet} ü™ô`;
                } else { resultMsg = "‡πÄ‡∏™‡∏°‡∏≠ AI!"; }
            } else {
                if(w === 'tie') { resultMsg = "‡πÄ‡∏™‡∏°‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!"; }
                else {
                    if(w === 'X') { coins += bet; resultMsg = `‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô! ‡∏¢‡∏∂‡∏î‡∏°‡∏≤ ${bet} ü™ô`; }
                    else { coins -= bet; if(coins < 0) coins = 0; resultMsg = `‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ä‡∏ô‡∏∞! ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏™‡∏µ‡∏¢ ${bet} ü™ô`; }
                }
            }

            history.unshift({ res: resultMsg, time: new Date().toLocaleTimeString() });
            if(history.length > 5) history.pop();
            localStorage.setItem('xo_history', JSON.stringify(history));
            localStorage.setItem('xo_coins', coins);
            setTimeout(() => { alert(resultMsg); updateUI(); }, 100);
        }

        function minimax(b, p) {
            let a = b.map((v,i)=>v===''?i:null).filter(v=>v!==null);
            if(checkWin(b, 'X')) return {score:-10};
            if(checkWin(b, 'O')) return {score:10};
            if(a.length===0) return {score:0};
            let moves = [];
            for(let i=0; i<a.length; i++) {
                let m = {index: a[i]}; b[a[i]] = p;
                m.score = minimax(b, p==='O'?'X':'O').score;
                b[a[i]] = ''; moves.push(m);
            }
            return moves.reduce((p_m, c_m) => (p === 'O' ? c_m.score > p_m.score : c_m.score < p_m.score) ? c_m : p_m);
        }

        function checkWin(b, p) { return [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]].some(c=>c.every(i=>b[i]===p)); }
        function randomMove() { let a=board.map((v,i)=>v===''?i:null).filter(v=>v!==null); return a[Math.floor(Math.random()*a.length)]; }
        function renderHistory() { document.getElementById('battle-log').innerHTML = history.map(h => `<div style="border-bottom:1px solid #334155; padding:5px 0;"><span>${h.res}</span> <small style="float:right; opacity:0.5;">${h.time}</small></div>`).join(''); }
        function redeemCode() { if(document.getElementById('promoInput').value==='GIFT2000'){ coins+=2000; localStorage.setItem('xo_coins', coins); updateUI(); alert("‡∏£‡∏ß‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ! +2000 ü™ô"); } }
        function resetGame() { board=Array(9).fill(''); gameActive=true; currentPlayer='X'; updateUI(); }
        if(userName) showGame();
    </script>
</body>
</html>
        let coins = parseInt(localStorage.getItem('xo_coins')) || 0;
        let userName = localStorage.getItem('xo_username') || '';
        let history = JSON.parse(localStorage.getItem('xo_history')) || [];
        let board = Array(9).fill('');
        let gameActive = true;
        let gameMode = 'ai'; // 'ai' ‡∏´‡∏£‡∏∑‡∏≠ 'pvp'
        let currentPlayer = 'X';

        function saveName() {
            const name = document.getElementById('usernameInput').value;
            if(name) { userName = name; localStorage.setItem('xo_username', name); showGame(); }
        }

        function showGame() {
            document.getElementById('setup-section').style.display='none';
            document.getElementById('game-section').style.display='block';
            updateUI();
        }

        function setMode(mode) {
            gameMode = mode;
            document.getElementById('btn-ai').className = mode === 'ai' ? 'mode-btn active' : 'mode-btn';
            document.getElementById('btn-pvp').className = mode === 'pvp' ? 'mode-btn active' : 'mode-btn';
            document.getElementById('difficulty').style.display = mode === 'ai' ? 'inline-block' : 'none';
            resetGame();
        }

        function updateUI() {
            const boardDiv = document.getElementById('board');
            boardDiv.innerHTML = '';
            board.forEach((cell, i) => {
                const btn = document.createElement('button');
                btn.className = 'cell'; btn.innerText = cell;
                btn.onclick = () => playTurn(i);
                boardDiv.appendChild(btn);
            });
            document.getElementById('coin-count').innerText = coins.toLocaleString();
            updateRank();
            renderHistory();
        }

        function updateRank() {
            let r="BRONZE", c="#cd7f32";
            if(coins>5000) { r="LEGEND"; c="#ef4444"; }
            else if(coins>2000) { r="GOLD"; c="#fbbf24"; }
            else if(coins>500) { r="SILVER"; c="#94a3b8"; }
            const b = document.getElementById('rank-display');
            b.innerText = `RANK: ${r}`; b.style.background = c;
        }

        function playTurn(i) {
            if(board[i] === '' && gameActive) {
                board[i] = currentPlayer;
                updateUI();
                
                if(checkWin(board, currentPlayer)) {
                    handleGameOver(currentPlayer);
                } else if(board.every(s=>s!=='')) {
                    handleGameOver('tie');
                } else {
                    if(gameMode === 'ai') {
                        gameActive = false;
                        setTimeout(aiMove, 500);
                    } else {
                        currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                        document.getElementById('turn-info').innerText = `‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á‡∏ù‡πà‡∏≤‡∏¢: ${currentPlayer}`;
                    }
                }
            }
        }

        function aiMove() {
            const diff = document.getElementById('difficulty').value;
            let m;
            // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡∏≤‡∏Å‡∏ô‡∏£‡∏Å: ‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™ 5% ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡∏°‡∏±‡πà‡∏ß (‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ä‡∏ô‡∏∞ 5%)
            if (diff === 'hard') {
                m = (Math.random() < 0.05) ? randomMove() : minimax(board, 'O').index;
            } else if (diff === 'medium') {
                m = (Math.random() < 0.4) ? minimax(board, 'O').index : randomMove();
            } else {
                m = randomMove();
            }

            board[m] = 'O';
            gameActive = true;
            if(checkWin(board, 'O')) handleGameOver('O');
            else if(board.every(s=>s!=='')) handleGameOver('tie');
            updateUI();
        }

        function handleGameOver(w) {
            gameActive = false;
            const bet = parseInt(document.getElementById('betAmount').value) || 0;
            const diff = document.getElementById('difficulty').value;
            let resultText = "";

            if(gameMode === 'ai') {
                if(w === 'X') {
                    const prize = {easy:10, medium:30, hard:50}[diff] + bet;
                    coins += prize;
                    resultText = `‡∏ä‡∏ô‡∏∞ AI! ‡∏£‡∏±‡∏ö ${prize} ü™ô`;
                } else if(w === 'O') {
                    coins -= bet; if(coins < 0) coins = 0;
                    resultText = `‡πÅ‡∏û‡πâ AI! ‡πÄ‡∏™‡∏µ‡∏¢ ${bet} ü™ô`;
                } else {
                    resultText = "‡πÄ‡∏™‡∏°‡∏≠ AI!";
                }
            } else {
                // ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô (PvP)
                if(w === 'tie') {
                    resultText = "‡πÄ‡∏™‡∏°‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!";
                } else {
                    // ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏¢‡∏∂‡∏î‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç (‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô)
                    if(w === 'X') {
                        coins += bet;
                        resultText = `‡∏ù‡πà‡∏≤‡∏¢ X ‡∏ä‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô! ‡∏¢‡∏∂‡∏î‡∏°‡∏≤‡πÑ‡∏î‡πâ ${bet} ü™ô`;
                    } else {
                        coins -= bet; if(coins < 0) coins = 0;
                        resultText = `‡∏ù‡πà‡∏≤‡∏¢ O ‡∏ä‡∏ô‡∏∞‡∏Ñ‡∏∏‡∏ì! ‡πÄ‡∏™‡∏µ‡∏¢‡πÑ‡∏õ ${bet} ü™ô`;
                    }
                }
            }

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
            history.unshift({ res: resultText, time: new Date().toLocaleTimeString() });
            if(history.length > 5) history.pop();
            localStorage.setItem('xo_history', JSON.stringify(history));
            localStorage.setItem('xo_coins', coins);
            
            setTimeout(() => { alert(resultText); updateUI(); }, 100);
        }

        function minimax(b, p) {
            let a = b.map((v,i)=>v===''?i:null).filter(v=>v!==null);
            if(checkWin(b, 'X')) return {score:-10};
            if(checkWin(b, 'O')) return {score:10};
            if(a.length===0) return {score:0};
            let moves = [];
            for(let i=0; i<a.length; i++) {
                let m = {index: a[i]}; b[a[i]] = p;
                m.score = minimax(b, p==='O'?'X':'O').score;
                b[a[i]] = ''; moves.push(m);
            }
            return moves.reduce((p_m, c_m) => (p === 'O' ? c_m.score > p_m.score : c_m.score < p_m.score) ? c_m : p_m);
        }

        function checkWin(b, p) { return [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]].some(c=>c.every(i=>b[i]===p)); }
        function randomMove() { let a=board.map((v,i)=>v===''?i:null).filter(v=>v!==null); return a[Math.floor(Math.random()*a.length)]; }
        function renderHistory() { document.getElementById('battle-log').innerHTML = history.map(h => `<div class="log-entry"><span>${h.res}</span><span style="color:#94a3b8">${h.time}</span></div>`).join(''); }
        function redeemCode() { if(document.getElementById('promoInput').value==='GIFT2000'){ coins+=2000; localStorage.setItem('xo_coins', coins); updateUI(); alert("‡∏£‡∏ß‡∏¢! ‡∏£‡∏±‡∏ö 2000 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç"); } }
        function resetGame() { board=Array(9).fill(''); gameActive=true; currentPlayer='X'; document.getElementById('turn-info').innerText = gameMode==='ai'?'‡πÇ‡∏´‡∏°‡∏î: ‡πÅ‡∏Ç‡πà‡∏á‡∏Å‡∏±‡∏ö AI':'‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á‡∏ù‡πà‡∏≤‡∏¢: X'; updateUI(); }
        if(userName) showGame();
    </script>
</body>
</html>
            { name: 'X-O', sym: ['X', 'O'], price: 0 },
            { name: 'Fire-Ice', sym: ['üî•', '‚ùÑÔ∏è'], price: 500 },
            { name: 'King-Skull', sym: ['üëë', 'üíÄ'], price: 1000 },
            { name: 'Cat-Dog', sym: ['üê±', 'üê∂'], price: 1500 },
            { name: 'Alien-Robot', sym: ['üëΩ', 'ü§ñ'], price: 2500 }
        ];

        let board = Array(9).fill('');
        let gameActive = true;

        function getSym() {
            const s = skins.find(x => x.name === currentSkin);
            return { hu: s.sym[0], ai: s.sym[1] };
        }

        function initUI() {
            // Board
            const boardDiv = document.getElementById('board');
            boardDiv.innerHTML = '';
            board.forEach((cell, i) => {
                const btn = document.createElement('button');
                btn.className = 'cell';
                btn.innerText = cell;
                btn.onclick = () => playTurn(i);
                boardDiv.appendChild(btn);
            });

            // Stats
            document.getElementById('coin-count').innerText = coins.toLocaleString();

            // Shop
            const shopDiv = document.getElementById('shop-items');
            shopDiv.innerHTML = '';
            skins.forEach(skin => {
                const isOwned = ownedSkins.includes(skin.name);
                const isEquipped = currentSkin === skin.name;
                
                shopDiv.innerHTML += `
                    <div class="skin-item">
                        <span>${skin.sym[0]} vs ${skin.sym[1]} (${skin.name})</span>
                        ${isEquipped ? '<span class="owned">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</span>' : 
                          isOwned ? `<button class="btn-use" onclick="setSkin('${skin.name}')">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ</button>` : 
                          `<button class="btn-buy" onclick="buySkin('${skin.name}', ${skin.price})">üí∞ ${skin.price}</button>`}
                    </div>
                `;
            });
        }

        function playTurn(index) {
            const sym = getSym();
            if (board[index] === '' && gameActive) {
                board[index] = sym.hu;
                if (!checkWin(board, sym.hu) && !checkTie()) {
                    gameActive = false;
                    setTimeout(aiMove, 500);
                } else {
                    handleGameOver(sym.hu);
                }
                initUI();
            }
        }

        function aiMove() {
            const sym = getSym();
            const diff = document.getElementById('difficulty').value;
            let move = (diff === 'hard') ? minimax(board, sym.ai).index : 
                       (diff === 'medium' && Math.random() > 0.4) ? minimax(board, sym.ai).index : 
                       randomMove();

            board[move] = sym.ai;
            gameActive = true;
            if (checkWin(board, sym.ai)) handleGameOver(sym.ai);
            else if (checkTie()) handleGameOver('tie');
            initUI();
        }

        function minimax(newBoard, player) {
            const sym = getSym();
            let avail = newBoard.map((v, i) => v === '' ? i : null).filter(v => v !== null);
            if (checkWin(newBoard, sym.hu)) return {score: -10};
            if (checkWin(newBoard, sym.ai)) return {score: 10};
            if (avail.length === 0) return {score: 0};

            let moves = [];
            for (let i = 0; i < avail.length; i++) {
                let move = { index: avail[i] };
                newBoard[avail[i]] = player;
                move.score = minimax(newBoard, player === sym.ai ? sym.hu : sym.ai).score;
                newBoard[avail[i]] = '';
                moves.push(move);
            }
            return moves.reduce((prev, curr) => 
                (player === sym.ai ? (curr.score > prev.score) : (curr.score < prev.score)) ? curr : prev
            );
        }

        function checkWin(b, p) {
            const win = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            return win.some(c => c.every(i => b[i] === p));
        }
        function checkTie() { return board.every(s => s !== ''); }
        function randomMove() {
            let avail = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
            return avail[Math.floor(Math.random() * avail.length)];
        }

        function handleGameOver(winner) {
            gameActive = false;
            const sym = getSym();
            if (winner === sym.hu) {
                const rewards = { easy: 10, medium: 30, hard: 50 };
                const prize = rewards[document.getElementById('difficulty').value];
                coins += prize;
                alert(`‡∏ä‡∏ô‡∏∞‡πÅ‡∏•‡πâ‡∏ß! ‡∏£‡∏±‡∏ö ${prize} ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç`);
            } else if (winner === sym.ai) alert("AI ‡∏ä‡∏ô‡∏∞! ‡∏ù‡∏∂‡∏Å‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞");
            else alert("‡πÄ‡∏™‡∏°‡∏≠!");
            saveData();
        }

        function buySkin(name, price) {
            if (coins >= price) {
                coins -= price;
                ownedSkins.push(name);
                saveData();
                initUI();
                alert(`‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏Å‡∏¥‡∏ô ${name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
            } else {
                alert("‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö ‡πÑ‡∏õ‡∏õ‡∏±‡πä‡∏°‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏à‡∏≤‡∏Å AI ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞!");
            }
        }

        function setSkin(name) {
            currentSkin = name;
            saveData();
            initUI();
        }

        function redeemCode() {
            if (document.getElementById('promoInput').value === 'GIFT2000') {
                coins += 2000;
                saveData();
                initUI();
                alert("‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ 2000 ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç!");
            }
        }

        function saveData() {
            localStorage.setItem('xo_coins', coins);
            localStorage.setItem('xo_skins', JSON.stringify(ownedSkins));
            localStorage.setItem('xo_current_skin', currentSkin);
        }

        function resetGame() {
            board = Array(9).fill('');
            gameActive = true;
            initUI();
        }

        initUI();
    </script>
</body>
</html>
