<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>XO SUPREME: OMNI-GOD EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #020617; --cyan: #22d3ee; --pink: #f43f5e; --gold: #fbbf24;
            --green: #10b981; --red: #ef4444; --glass: rgba(15, 23, 42, 0.85);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Kanit', sans-serif; background: var(--bg); color: white;
            margin: 0; padding: 10px; display: flex; justify-content: center;
            min-height: 100vh; overflow-y: auto;
            background: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #020617 100%);
        }
        .container {
            width: 100%; max-width: 480px; background: var(--glass);
            backdrop-filter: blur(20px); border-radius: 35px; padding: 20px;
            border: 1px solid rgba(255,255,255,0.1); position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.8);
            margin-bottom: 50px;
        }

        /* Top Bar */
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-family: 'Orbitron'; font-size: 0.75rem; }
        .net-status { display: flex; align-items: center; gap: 6px; background: rgba(0,0,0,0.4); padding: 5px 10px; border-radius: 20px; }
        .ping-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--green); box-shadow: 0 0 5px var(--green); }
        .lang-btn { background: linear-gradient(90deg, #3b82f6, #2563eb); border: none; color: white; padding: 5px 12px; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* Level & Quest */
        .stats-panel { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 15px; margin-bottom: 15px; }
        .level-row { display: flex; justify-content: space-between; font-family: 'Orbitron'; font-size: 0.8rem; margin-bottom: 5px; color: var(--cyan); }
        .exp-track { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        .exp-fill { height: 100%; background: linear-gradient(90deg, var(--cyan), #818cf8); width: 0%; transition: 0.5s; }
        
        .quest-box { margin-top: 8px; font-size: 0.75rem; color: #cbd5e1; display: flex; align-items: center; gap: 5px; }
        .quest-check { color: var(--gold); }

        .coin-box { font-size: 2.2rem; color: var(--gold); font-weight: bold; font-family: 'Orbitron'; text-shadow: 0 0 15px rgba(251, 191, 36, 0.3); margin: 10px 0; }

        /* Matchmaking Overlay */
        #match-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(2, 6, 23, 0.95); z-index: 100; border-radius: 35px;
            display: none; flex-direction: column; justify-content: center; align-items: center;
        }
        .loader { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); border-top: 5px solid var(--cyan); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .vs-text { font-family: 'Orbitron'; font-size: 2rem; color: var(--red); font-weight: 900; animation: pulse 0.8s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* Chat */
        .chat-box { background: rgba(0,0,0,0.4); border-radius: 15px; height: 120px; overflow-y: auto; padding: 10px; margin: 10px 0; font-size: 0.75rem; text-align: left; border: 1px solid rgba(255,255,255,0.05); }
        .chat-msg { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.03); padding-bottom: 2px; }
        .chat-user { color: var(--cyan); font-weight: bold; font-family: 'Orbitron'; }
        .chat-sys { color: var(--gold); font-style: italic; }

        /* Game Board */
        .board { display: grid; gap: 8px; background: rgba(0,0,0,0.3); padding: 12px; border-radius: 25px; border: 1px solid rgba(255,255,255,0.1); margin: 15px 0; }
        .board-3 { grid-template-columns: repeat(3, 1fr); }
        .board-5 { grid-template-columns: repeat(5, 1fr); }
        .cell { aspect-ratio: 1/1; background: rgba(30, 41, 59, 0.6); border-radius: 12px; font-size: 2rem; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); transition: transform 0.1s; }
        .cell:active { transform: scale(0.9); }

        /* Controls */
        .btn { font-family: 'Orbitron'; background: linear-gradient(90deg, #0ea5e9, #6366f1); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 5px; font-size: 0.85rem; transition: 0.3s; }
        .btn:hover { filter: brightness(1.2); }
        .btn-gold { background: linear-gradient(90deg, #f59e0b, #ea580c); }
        .btn-red { background: linear-gradient(90deg, #ef4444, #b91c1c); }

        .skin-tray { display: flex; gap: 10px; overflow-x: auto; padding: 10px 5px; scrollbar-width: none; }
        .skin-item { min-width: 60px; height: 60px; background: rgba(0,0,0,0.4); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; border: 2px solid transparent; flex-shrink: 0; position: relative; }
        .skin-item.active { border-color: var(--cyan); box-shadow: 0 0 15px var(--cyan) inset; }
        .lock-icon { position: absolute; font-size: 0.8rem; bottom: 2px; right: 2px; }

        input, select { background: rgba(0,0,0,0.5); border: 1px solid #334155; color: white; padding: 10px; border-radius: 12px; width: 100%; margin-bottom: 8px; font-family: 'Kanit'; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <div id="match-overlay">
        <div class="loader"></div>
        <h2 id="match-status" style="font-family: 'Orbitron'; letter-spacing: 2px;">SEARCHING...</h2>
        <div id="match-vs" style="display:none; text-align:center;">
            <p>OPPONENT FOUND</p>
            <div class="vs-text" id="opp-name">BOT_01</div>
            <p style="color:var(--cyan); font-size:0.8rem;">RANK: GOLD III</p>
        </div>
    </div>

    <div class="top-bar">
        <div class="net-status">
            <div id="ping-dot" class="ping-dot"></div>
            <span><span id="ping-val">24</span> ms</span>
        </div>
        <button class="lang-btn" onclick="toggleLang()" id="lang-btn">EN</button>
    </div>

    <div id="scr-start">
        <h1 id="t-title" style="margin-bottom:5px; font-size:2rem; background:linear-gradient(90deg, #22d3ee, #f43f5e); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">XO SUPREME</h1>
        <p style="font-size:0.7rem; opacity:0.8; letter-spacing:3px; margin-top:0;">OMNI-GOD EDITION</p>
        <div style="margin-top: 40px;">
            <input type="text" id="inName" placeholder="ENTER AGENT NAME">
            <button class="btn" onclick="login()" id="t-login">CONNECT</button>
        </div>
    </div>

    <div id="scr-game" style="display:none">
        
        <div class="stats-panel">
            <div class="level-row">
                <span id="lvl-txt">LVL 1</span>
                <span id="exp-txt">0/200</span>
            </div>
            <div class="exp-track"><div id="exp-fill" class="exp-fill"></div></div>
            <div class="quest-box">
                ðŸ“œ <span id="quest-txt">Quest: Win 3 Games</span> <span id="quest-prog">(0/3)</span>
            </div>
        </div>

        <div class="coin-box">ðŸª™ <span id="coin-txt">0</span></div>

        <div class="chat-box" id="chat-content"></div>
        <div style="display:flex; gap:5px; margin-bottom:10px;">
            <input type="text" id="chat-input" placeholder="..." style="margin-bottom:0;">
            <button class="btn" style="width:60px; margin-top:0;" onclick="sendChat()" id="t-send">âž¤</button>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <button class="btn btn-gold" onclick="spin()" id="t-spin">SPIN</button>
            <button class="btn" style="background:#8b5cf6;" onclick="buyLoot()" id="t-loot">LOOT (300)</button>
        </div>

        <div class="skin-tray" id="tray"></div>

        <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:15px; margin-top:10px;">
            <select id="size-mode" onchange="initGame(false)">
                <option value="3">CLASSIC (3x3)</option>
                <option value="5">ELITE (5x5)</option>
            </select>
            <div id="grid" class="board"></div>
            <button class="btn btn-red" onclick="startMatchmaking()" id="t-play">FIND MATCH</button>
        </div>

        <div style="margin-top:20px; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">
            <div style="display:flex; gap:5px;">
                <input type="text" id="codeIn" placeholder="SECRET CODE" style="margin-bottom:0;">
                <button class="btn" style="width:80px; background:#10b981; margin-top:0;" onclick="redeem()" id="t-redeem">USE</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Data & Config ---
    let lang = 'TH';
    let user = localStorage.getItem('xo_god_user') || '';
    let coins = parseInt(localStorage.getItem('xo_god_coins')) || 0;
    let exp = parseInt(localStorage.getItem('xo_god_exp')) || 0;
    let lvl = parseInt(localStorage.getItem('xo_god_lvl')) || 1;
    let owned = JSON.parse(localStorage.getItem('xo_god_skins')) || ['Default'];
    let quest = JSON.parse(localStorage.getItem('xo_god_quest')) || { target: 3, current: 0, done: false };
    
    // Game State
    let board = [];
    let isPlaying = false; // Must matchmake first
    let skin = 'Default';
    let currentPing = 30;
    let opponentName = "AI-BOT";
    
    // Assets
    const skinsData = [
        {id:'Default', s:['X','O'], r:'Common'}, 
        {id:'Neon', s:['ðŸ’ ','ðŸ’Ž'], r:'Rare'}, 
        {id:'Fire', s:['ðŸ”¥','â„ï¸'], r:'Epic'}, 
        {id:'God', s:['ðŸ‘‘','ðŸ’€'], r:'Legendary'},
        {id:'Space', s:['ðŸš€','ðŸ‘¾'], r:'Legendary'}
    ];
    
    const i18n = {
        TH: { 
            login:"à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­", play:"à¸„à¹‰à¸™à¸«à¸²à¸«à¹‰à¸­à¸‡", spin:"à¸§à¸‡à¸¥à¹‰à¸­", loot:"à¸ªà¸¸à¹ˆà¸¡à¸‚à¸­à¸‡", 
            redeem:"à¸¢à¸·à¸™à¸¢à¸±à¸™", send:"à¸ªà¹ˆà¸‡", title:"XO à¸‹à¸¹à¸žà¸£à¸µà¸¡", 
            quest:"à¸ à¸²à¸£à¸à¸´à¸ˆ: à¸Šà¸™à¸° 3 à¹€à¸à¸¡", search:"à¸à¸³à¸¥à¸±à¸‡à¸„à¹‰à¸™à¸«à¸²...", found:"à¹€à¸ˆà¸­à¸„à¸¹à¹ˆà¹à¸‚à¹ˆà¸‡!",
            win:"à¸Šà¸™à¸°!", lose:"à¹à¸žà¹‰!", draw:"à¹€à¸ªà¸¡à¸­", unlock:"à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸„"
        },
        EN: { 
            login:"CONNECT", play:"FIND MATCH", spin:"SPIN", loot:"LOOT BOX", 
            redeem:"REDEEM", send:"SEND", title:"XO SUPREME", 
            quest:"Quest: Win 3 Games", search:"SEARCHING...", found:"OPPONENT FOUND",
            win:"VICTORY!", lose:"DEFEAT!", draw:"DRAW", unlock:"UNLOCKED"
        }
    };

    // --- Core System ---
    function init() {
        if(user) login();
        updatePing();
        setInterval(randomChat, 8000);
    }

    function toggleLang() {
        lang = lang === 'TH' ? 'EN' : 'TH';
        document.getElementById('lang-btn').innerText = lang;
        updateUI();
    }

    function updatePing() {
        setInterval(() => {
            currentPing = Math.floor(Math.random() * 60) + 20;
            if(Math.random() > 0.9) currentPing += 150; // Lag spike
            const d = document.getElementById('ping-dot');
            const v = document.getElementById('ping-val');
            v.innerText = currentPing;
            d.style.background = currentPing < 100 ? '#10b981' : '#ef4444';
            d.style.boxShadow = `0 0 5px ${d.style.background}`;
        }, 1500);
    }

    function login() {
        let n = document.getElementById('inName').value || user;
        if(n) {
            user = n; localStorage.setItem('xo_god_user', user);
            document.getElementById('scr-start').style.display = 'none';
            document.getElementById('scr-game').style.display = 'block';
            updateUI(); initGame(false);
        }
    }

    // --- Matchmaking System ---
    function startMatchmaking() {
        if(isPlaying) { if(!confirm("Reset current game?")) return; }
        
        const overlay = document.getElementById('match-overlay');
        const status = document.getElementById('match-status');
        const vs = document.getElementById('match-vs');
        const playBtn = document.getElementById('t-play');
        
        overlay.style.display = 'flex';
        status.innerText = i18n[lang].search;
        status.style.display = 'block';
        vs.style.display = 'none';

        // Fake Delay 2-4 seconds
        setTimeout(() => {
            const botNames = ["Killer_Z", "NoobMaster", "ProPlayer99", "Agent_X", "Somsak_TH", "AI_Prime"];
            opponentName = botNames[Math.floor(Math.random() * botNames.length)];
            
            status.style.display = 'none';
            vs.style.display = 'block';
            document.getElementById('opp-name').innerText = opponentName;
            
            setTimeout(() => {
                overlay.style.display = 'none';
                initGame(true); // Start actual game
                playBtn.innerText = "RESET / SURRENDER";
                addChatSys(`Match started: ${user} VS ${opponentName}`);
            }, 2000);
        }, 2000 + Math.random()*2000);
    }

    // --- Game Logic ---
    function initGame(active) {
        let s = parseInt(document.getElementById('size-mode').value);
        board = Array(s*s).fill('');
        isPlaying = active;
        const g = document.getElementById('grid');
        g.className = `board board-${s}`;
        g.style.opacity = active ? "1" : "0.5"; // Dim if not playing
        renderBoard();
    }

    function renderBoard() {
        const g = document.getElementById('grid'); g.innerHTML = '';
        board.forEach((v, i) => {
            const c = document.createElement('div');
            c.className = 'cell'; c.innerText = v;
            const icons = getIcons();
            if(v) {
                c.style.color = (v === icons[0]) ? 'var(--cyan)' : 'var(--pink)';
                c.style.textShadow = `0 0 10px ${c.style.color}`;
            }
            c.onclick = () => tap(i);
            g.appendChild(c);
        });
    }

    function tap(i) {
        if(!isPlaying) { alert("Please press FIND MATCH first!"); return; }
        if(board[i] === '') {
            // Network Lag Simulation
            setTimeout(() => {
                let icons = getIcons();
                board[i] = icons[0];
                renderBoard();
                if(checkWin(icons[0])) endGame('win');
                else if(board.every(x=>x!=='')) endGame('draw');
                else {
                    // Bot Turn
                    setTimeout(botMove, 500); 
                }
            }, currentPing/2); // Input delay
        }
    }

    function botMove() {
        if(!isPlaying) return;
        let empty = board.map((v,i)=>v===''?i:null).filter(v=>v!==null);
        if(empty.length > 0) {
            let icons = getIcons();
            let move = empty[Math.floor(Math.random()*empty.length)];
            board[move] = icons[1];
            renderBoard();
            if(checkWin(icons[1])) endGame('lose');
            else if(board.every(x=>x!=='')) endGame('draw');
        }
    }

    function checkWin(p) {
        let sz = parseInt(document.getElementById('size-mode').value);
        let win = sz === 3 ? 3 : 4;
        for(let i=0; i<sz*sz; i++) {
            if(board[i]===p) {
                // Horizontal & Vertical checks omitted for brevity (same logic)
                // Using simplified logic for brevity but ensuring 3x3/5x5 works
                if(checkLine(i, 1, win, p, sz)) return true; // Horiz
                if(checkLine(i, sz, win, p, sz)) return true; // Vert
                if(checkLine(i, sz+1, win, p, sz)) return true; // Diag \
                if(checkLine(i, sz-1, win, p, sz)) return true; // Diag /
            }
        }
        return false;
    }
    function checkLine(idx, step, target, p, sz) {
        // Simple bounds check logic required here
        let count = 0;
        for(let k=0; k<target; k++) {
            let next = idx + k*step;
            if(next >= sz*sz) return false;
            // Row wrap checks
            if(step===1 && Math.floor(idx/sz) !== Math.floor(next/sz)) return false; 
            if(step===sz-1 && Math.floor(next/sz) !== Math.floor(idx/sz)+k) return false;
            if(step===sz+1 && Math.floor(next/sz) !== Math.floor(idx/sz)+k) return false;
            if(board[next] === p) count++;
        }
        return count === target;
    }

    function endGame(result) {
        isPlaying = false;
        document.getElementById('t-play').innerText = i18n[lang].play;
        
        if(result === 'win') {
            coins += 100; addExp(50);
            updateQuest();
            confetti({particleCount:150});
            alert(i18n[lang].win + " +100 Coins");
        } else if(result === 'lose') {
            addExp(10); alert(i18n[lang].lose);
        } else {
            addExp(20); alert(i18n[lang].draw);
        }
        updateUI();
    }

    // --- Progression ---
    function addExp(amt) {
        exp += amt;
        if(exp >= lvl * 200) {
            exp -= lvl * 200; lvl++; coins += 500;
            addChatSys(`LEVEL UP! You are now LVL ${lvl}`);
        }
        save();
    }

    function updateQuest() {
        if(!quest.done) {
            quest.current++;
            if(quest.current >= quest.target) {
                quest.done = true; coins += 300;
                addChatSys("Daily Quest Completed! +300 Coins");
            }
            save();
        }
    }

    // --- UI & Store ---
    function updateUI() {
        // Text Updates
        const t = i18n[lang];
        document.getElementById('t-login').innerText = t.login;
        document.getElementById('t-play').innerText = isPlaying ? "RESET" : t.play;
        document.getElementById('t-spin').innerText = t.spin;
        document.getElementById('t-loot').innerText = t.loot;
        document.getElementById('t-redeem').innerText = t.redeem;
        document.getElementById('t-title').innerText = t.title;

        // Stats
        document.getElementById('coin-txt').innerText = coins.toLocaleString();
        document.getElementById('lvl-txt').innerText = `LVL ${lvl}`;
        document.getElementById('exp-txt').innerText = `${exp}/${lvl*200}`;
        document.getElementById('exp-fill').style.width = `${(exp/(lvl*200))*100}%`;
        
        // Quest
        document.getElementById('quest-txt').innerText = t.quest;
        document.getElementById('quest-prog').innerText = quest.done ? "âœ…" : `(${quest.current}/${quest.target})`;
        
        // Skins
        const tray = document.getElementById('tray'); tray.innerHTML = '';
        skinsData.forEach(sk => {
            const isOwned = owned.includes(sk.id);
            if(isOwned) {
                const d = document.createElement('div');
                d.className = `skin-item ${skin===sk.id?'active':''}`;
                d.innerHTML = sk.s[0];
                d.onclick = () => { skin = sk.id; renderBoard(); updateUI(); };
                tray.appendChild(d);
            }
        });
        save();
    }

    function getIcons() { return skinsData.find(x=>x.id===skin).s; }

    function spin() { 
        coins += 50; addExp(5); 
        alert(`Lucky Spin: +50 Coins`); updateUI(); 
    }
    
    function buyLoot() {
        if(coins < 300) { alert("Need 300 Coins!"); return; }
        coins -= 300;
        const unowned = skinsData.filter(s => !owned.includes(s.id));
        if(unowned.length > 0) {
            const got = unowned[Math.floor(Math.random()*unowned.length)];
            owned.push(got.id);
            alert(`${i18n[lang].unlock}: ${got.id} (${got.r})`);
        } else {
            coins += 150; alert("Duplicate! +150 Coins back.");
        }
        updateUI();
    }

    function redeem() {
        const c = document.getElementById('codeIn').value.toUpperCase();
        // 10 Codes
        const codes = {
            'WELCOME2025':1000, 'DIAMOND777':7777, 'FREEFIRE':500,
            'ROVGRAND':2000, 'LUCKYDAY':300, 'CONQUEROR':5000,
            'GEMINI':1500, 'LASTSURVIVOR':888, 'NEWYEAR':2025, 'RICHMAN':999
        };
        
        if(codes[c]) { coins += codes[c]; alert("Code Redeem Success!"); }
        else if(c === 'SKINFREE' && !owned.includes('Neon')) { owned.push('Neon'); alert("Skin Neon Unlocked!"); }
        else if(c === 'GODMODE' && !owned.includes('God')) { owned.push('God'); alert("Skin God Unlocked!"); }
        else { alert("Invalid or Expired Code"); }
        document.getElementById('codeIn').value = ''; updateUI();
    }

    // --- Chat ---
    function sendChat() {
        const inp = document.getElementById('chat-input');
        if(inp.value) {
            addMsg(user, inp.value);
            inp.value = '';
        }
    }
    function addChatSys(msg) {
        const b = document.getElementById('chat-content');
        b.innerHTML += `<div class="chat-msg chat-sys">[SYS] ${msg}</div>`;
        b.scrollTop = b.scrollHeight;
    }
    function addMsg(u, m) {
        const b = document.getElementById('chat-content');
        b.innerHTML += `<div class="chat-msg"><span class="chat-user">${u}:</span> ${m}</div>`;
        b.scrollTop = b.scrollHeight;
    }
    function randomChat() {
        const msgs = ["Who wants to 1v1?", "Got God Skin finally!", "Lagging?", "Anyone active?", "Hi server!"];
        const usrs = ["Player1", "Sniper_X", "CatLover", "MobaGod"];
        addMsg(usrs[Math.floor(Math.random()*usrs.length)], msgs[Math.floor(Math.random()*msgs.length)]);
    }

    function save() {
        localStorage.setItem('xo_god_coins', coins);
        localStorage.setItem('xo_god_exp', exp);
        localStorage.setItem('xo_god_lvl', lvl);
        localStorage.setItem('xo_god_skins', JSON.stringify(owned));
        localStorage.setItem('xo_god_quest', JSON.stringify(quest));
    }

    init();
</script>
</body>
</html>
